#!/usr/bin/env bash
source ./bin/create-envfile
source ./.env

TIMESTAMP=$(date +%Y-%m-%d_%H-%M-%S)

REMOTE_FILENAME="${MYSQL_DUMP_DIR}/magento2.${TIMESTAMP}.sql.gz"
BASE_COMMAND="/usr/bin/mysqldump -u root -p${MYSQL_PASSWORD} ${MYSQL_DATABASE} | gzip -9 > ${REMOTE_FILENAME}"

echo "Exporting database to ${REMOTE_FILENAME}"
bin/exec-root -T db /bin/bash -c "${BASE_COMMAND}"
bin/exec-root chown 1000: ${REMOTE_FILENAME}

#echo "Copying from container to ${MYSQL_DUMP_DIR}"
#docker cp $(bin/helper/container-id db):${REMOTE_FILENAME} ${MYSQL_DUMP_DIR}
#bin/exec-root -T db rm -rf ${MYSQL_DUMP_DIR}/*
